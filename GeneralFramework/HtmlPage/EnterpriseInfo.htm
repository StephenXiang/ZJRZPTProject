<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>企业信息</title>
    <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.5.1/themes/bootstrap/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.5.1/themes/icon.css" />
    <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.5.1/demo/demo.css" />
    <script type="text/javascript" src="../jquery-easyui-1.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="../jquery-easyui-1.5.1/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../jquery-easyui-1.5.1/locale/easyui-lang-zh_CN.js"></script>
    <script src="../Scripts/jquery.cookie.js"></script>
    <script type="text/javascript">
        var UserInfo;
        var Enterprise;
        $(function () {
            $('#UserNameTD').hide();
            $('#Enterprisedlg').dialog('close');
            UserInfo = JSON.parse($.cookie('UserInfo'));
            loadEnterpriseInfo();
            if (UserInfo["role"] == 4) {
                $('#Enterprise_div').hide();
                $('#editEnterprisrInfoBtn').show();
                $('#EnterpriseFinanceInfoBtn').show();
            } else {
                $('#Enterprise_div').show();
                $('#editEnterprisrInfoBtn').hide();
                $('#EnterpriseFinanceInfoBtn').hide();
            }
            $('#Enterprise_dg').datagrid({
                // url: '../../WebServer/UserLoginWebService.ashx?Method=GetUserTBJson',
                rownumbers: true,
                singleSelect: true,
                striped: true,
                title: '企业列表',
                fitColumns: true,
                pagination: true,
                pagePosition: 'bottom',
                loadMsg: '正在加载数据...请稍后',
                pageNumber: 1,
                pageSize: 10,
                pageList: [10, 20, 30],
                columns: [[
                    { field: 'ID', title: 'ID', width: 150, hidden: true, align: 'center' },
                    { field: 'UserRolesID', title: '企业名称', width: 150, align: 'center' },
                    { field: 'UserDepartment', title: '融资额度', width: 150, align: 'center' },
                    { field: 'UserID', title: '发布日期', width: 150, align: 'center' },
                    {
                        field: 'IsEnable', title: '审核', width: 150, align: 'center', formatter:
                        function (value, row, index) {
                            UserID = row.ID;
                            if (value == 0) {
                                return '<a href="#" onclick="UnlockAccount(0,' + row.ID + ')">停用</a>'
                            } else if (value == 1) {
                                return '<a href="#" onclick="UnlockAccount(1,' + row.ID + ')">启用</a>'
                            }
                        }
                    }
                ]]
            });
        });

        function OpenEnterprisrdlg() {
            $('#RegistTypeCmb').combobox({
                //width: 145,
                url: '../../WebServer/EnterpriseService.ashx?Method=GetRegistType',
                valueField: 'ID',
                textField: 'TypeName'
            });
            $('#ProfessionCmb').combobox({
                //width: 145,
                url: '../../WebServer/EnterpriseService.ashx?Method=GetProfessionType',
                valueField: 'ID',
                textField: 'TypeName'
            });
            $('#EnterpriseTypeCmb').combobox({
                //width: 145,
                url: '../../WebServer/EnterpriseService.ashx?Method=GetEnterpriseType',
                valueField: 'ID',
                textField: 'TypeName'
            });
            $('#RegistRegionCmb').combobox({
                //width: 145,
                url: '../../WebServer/EnterpriseService.ashx?Method=GetRegionType',
                valueField: 'ID',
                textField: 'TypeName'
            });
            $('#HuanpingCmb').combobox({
                //width: 145,
                url: '../../WebServer/EnterpriseService.ashx?Method=GetHuanPingType',
                valueField: 'ID',
                textField: 'TypeName'
            });
            $('#RegFinanceCmb').combobox({
                //width: 145,
                url: '../../WebServer/EnterpriseService.ashx?Method=GetRegFinance',
                valueField: 'ID',
                textField: 'TypeName'
            });
            $('#RegFinanceMtCmb').combobox({
                //width: 145,
                url: '../../WebServer/EnterpriseService.ashx?Method=GetMoneyType',
                valueField: 'ID',
                textField: 'TypeName'
            });
            $('#BusinessCmb').combobox({
                //width: 145,
                url: '../../WebServer/EnterpriseService.ashx?Method=GetBusinessType',
                valueField: 'ID',
                textField: 'TypeName'
            });
            $('#UserNametxt').textbox("setValue", UserInfo["name"]);
            $('#Enterprisedlg').dialog('open');
        }

        function SaveEnterprisrInfo() {
            if ($('#EnterpriseName').val().trim() == "") {
                $.messager.alert('提示', '企业名称不得为空', 'info');
            }
            else if ($('#Code').val() == "") {
                $.messager.alert('提示', '信用代码不得为空', 'info');
            }
            else if ($('#Code').val().trim().length != 18) {
                $.messager.alert('提示', '信用代码不得大于或小于18位', 'info');
            }
            else if ($('#BusinessLicenseFile').textbox('getValue') == "") {
                $.messager.alert('提示', '请上传营业执照', 'info');
            }
            else if ($('#ProfessionCmb').combobox('getValue') == "") {
                $.messager.alert('提示', '行业分类必须选择', 'info');
            }
            else if ($('#EnterpriseTypeCmb').combobox('getValue') == "") {
                $.messager.alert('提示', '企业类型必须选择', 'info');
            }
            else if ($('#RegistRegionCmb').combobox('getValue') == "") {
                $.messager.alert('提示', '注册地必须选择', 'info');
            }
            else if ($('#HuanpingCmb').combobox('getValue') == "") {
                $.messager.alert('提示', '环评结果必须选择', 'info');
            }
            else if ($('#CreateTime').val() == "") {
                $.messager.alert('提示', '企业成立时间必须选择', 'info');
            }
            else if ($('#ConectionPerson').val() == "") {
                $.messager.alert('提示', '联系人不得为空', 'info');
            }
            else if ($('#ConnectionTelephone').val() == "") {
                $.messager.alert('提示', '联系人电话不得为空', 'info');
            }
            else {
                var formData = new FormData($("#ff")[0]);
                $.ajax({
                    url: "../../WebServer/EnterpriseService.ashx?Method=SaveEnterpriseInfo",
                    type: 'POST',
                    data: formData,
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        if (data == "True") {
                            $.messager.alert('提示', '保存成功', 'info');
                            $('#Enterprisedlg').dialog('close');
                        } else {
                            $.messager.alert('提示', '保存失败', 'error');
                        }
                    }
                });
            }
        }

        function loadEnterpriseInfo() {
            $.ajax({
                type: "Post",
                dataType: "json",
                async: false,
                data: { UserName: UserInfo["name"] },
                url: "../../WebServer/EnterpriseService.ashx?Method=GetEnterpriseInfoForUserName",
                success: function (json) {
                    Enterprise = json;
                    if (Enterprise["DataCount"] == 0) {
                        $.messager.confirm('提示', '您还没有登记企业基本信息，是否现在登记？', function (r) {
                            if (r) {
                                $('#Enterprisedlg').dialog('open');
                            }
                        });

                    } else {
                        $('#labEnterpriseName').html(Enterprise["Name"]);
                        $('#labCode').html(Enterprise["Code"]);
                        $('#labRegistType').html(Enterprise["RegistType"]);
                        $('#labProfession').html(Enterprise["Profession"]);
                        $('#labEnterpriseType').html(Enterprise["EnterpriseType"]);
                        $('#labRegistRegion').html(Enterprise["RegistRegion"]);
                        $('#labHuanping').html(Enterprise["Huanping"]);
                        $('#labRegFinance').html(Enterprise["RegFinance"]);
                        $('#labRegFinanceMt').html(Enterprise["RegFinanceMt"]);
                        $('#labBusiness').html(Enterprise["Business"]);
                        $('#labMainProduction').html(Enterprise["MainProduction"]);
                        $('#labCreateTime').html(Enterprise["CreateTime"]);
                        $('#labJuridicalPerson').html(Enterprise["JuridicalPerson"]);
                        $('#labConectionPerson').html(Enterprise["ConectionPerson"]);
                        $('#labConectionTelephone').html(Enterprise["ConnectionTelephone"]);
                        $('#labDesc').html(Enterprise["Desc"]);
                    }
                }
            });
        }
    </script>

</head>
<body class="easyui-layout">
    <div id="Enterprise_div">
        <table id="Enterprise_dg" data-options="
                iconCls: 'icon-save',
                buttons: '#RZ_dg-buttons'
            "></table>
    </div>
    <div class="easyui-panel" title="企业信息" style="width:100%;height:420px;padding:10px;">
        <div class="easyui-layout" data-options="fit:true">
            <div data-options="region:'west',split:false" style="width:35%;padding:10px;">
                <h2> 企业信息</h2>
                <div class="easyui-layout" data-options="fit:false" style=" height:280px; width:98%; padding-bottom:5px;">
                    <div data-options="region:'center'" style="width:33%;padding:10px">
                        <h3> 基本信息</h3>
                        <table border="0" style=" width:100%; border-collapse:separate; border-spacing:0px 6px;">
                            <tr>
                                <td style=" text-align:right;">企业名称:</td>
                                <td style=" text-align:left;"><label id="labEnterpriseName" /></td>
                                <td style=" text-align:right;">信用代码:</td>
                                <td style=" text-align:left;"><label id="labCode" /></td>
                                <td style=" text-align:right;">登记注册类型:</td>
                                <td style=" text-align:left;"><label id="labRegistType" /></td>
                            </tr>
                            <tr>

                                <td style=" text-align:right;">行业分类:</td>
                                <td style=" text-align:left;"><label id="labProfession" /></td>
                                <td style=" text-align:right;">企业类型:</td>
                                <td style=" text-align:left;"><label id="labEnterpriseType" /></td>
                                <td style=" text-align:right;">注册地:</td>
                                <td style=" text-align:left;"><label id="labRegistRegion" /></td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">环评结果:</td>
                                <td style=" text-align:left;"><label id="labHuanping" /></td>
                                <td style=" text-align:right;">注册资金额度:</td>
                                <td style=" text-align:left;"><label id="labRegFinance" /></td>
                                <td style=" text-align:right;">币种:</td>
                                <td style=" text-align:left;"><label id="labRegFinanceMt" /></td>
                            </tr>

                            <tr>

                                <td style=" text-align:right;">企业营业范围:</td>
                                <td style=" text-align:left;"><label id="labBusiness" /></td>
                                <td style=" text-align:right;">主要产品:</td>
                                <td style=" text-align:left;"><label id="labMainProduction" /></td>
                                <td style=" text-align:right;">企业成立时间:</td>
                                <td style=" text-align:left;"><label id="labCreateTime" /></td>
                            </tr>


                            <tr>
                                <td style=" text-align:right;">企业法人代表:</td>
                                <td style=" text-align:left;"><label id="labJuridicalPerson" /></td>
                                <td style=" text-align:right;">联系人姓名:</td>
                                <td style=" text-align:left;"><label id="labConectionPerson" /></td>
                                <td style=" text-align:right;">联系人电话:</td>
                                <td style=" text-align:left;"><label id="labConectionTelephone" /></td>

                            </tr>
                            <tr>
                                <td style=" text-align:right;">企业简介:</td>
                                <td style=" text-align:left;" colspan="5"><label id="labDesc" /></td>

                            </tr>
                            <tr>
                                <td style=" text-align:right;">营业执照:</td>
                                <td style=" text-align:center;"></td>

                            </tr>


                        </table>
                    </div>
                </div>

                <a href="#" id="editEnterprisrInfoBtn" class="easyui-linkbutton" onclick="OpenEnterprisrdlg()">编辑基本信息</a>

            </div>
            <div data-options="region:'center'" style="padding:10px">
                <h2>财务信息</h2>
                <div class="easyui-layout" data-options="fit:false" style=" height:280px; width:99%;padding-bottom:5px;">
                    <div data-options="region:'west'" style="width:33%;padding:10px">
                        <h3> 2015年</h3>
                        <table border="0" style=" width:100%; border-collapse:separate; border-spacing:0px 6px;">
                            <tr>
                                <td style=" text-align:right;">资产总额:</td>
                                <td style=" text-align:right;">200&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">负债总额:</td>
                                <td style=" text-align:right;">50&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">所有者权益:</td>
                                <td style=" text-align:right;">150&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">销售收入:</td>
                                <td style=" text-align:right;">800&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">应收账款:</td>
                                <td style=" text-align:right;">200&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">净利润:</td>
                                <td style=" text-align:right;">50&nbsp万</td>
                            </tr>
                        </table>
                    </div>
                    <div data-options="region:'east'" style="width:33%;padding:10px">
                        <h3> 最近一个月</h3>
                        <table border="0" style=" width:100%; border-collapse:separate; border-spacing:0px 6px;">
                            <tr>
                                <td style=" text-align:right;">资产总额:</td>
                                <td style=" text-align:right;">200&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">负债总额:</td>
                                <td style=" text-align:right;">50&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">所有者权益:</td>
                                <td style=" text-align:right;">150&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">销售收入:</td>
                                <td style=" text-align:right;">800&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">应收账款:</td>
                                <td style=" text-align:right;">200&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">净利润:</td>
                                <td style=" text-align:right;">50&nbsp万</td>
                            </tr>
                        </table>
                    </div>
                    <div data-options="region:'center'" style="width:33%;padding:10px">
                        <h3> 2016年</h3>
                        <table border="0" style=" width:100%; border-collapse:separate; border-spacing:0px 6px;">
                            <tr>
                                <td style=" text-align:right;">资产总额:</td>
                                <td style=" text-align:right;">200&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">负债总额:</td>
                                <td style=" text-align:right;">50&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">所有者权益:</td>
                                <td style=" text-align:right;">150&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">销售收入:</td>
                                <td style=" text-align:right;">800&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">应收账款:</td>
                                <td style=" text-align:right;">200&nbsp万</td>
                            </tr>
                            <tr>
                                <td style=" text-align:right;">净利润:</td>
                                <td style=" text-align:right;">50&nbsp万</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <a href="#" id="EnterpriseFinanceInfoBtn" class="easyui-linkbutton">编辑财务信息</a>
            </div>
        </div>
    </div>

    <div id="Enterprisedlg" class="easyui-dialog" title="企业信息编辑" style="text-align: center;
        width: 600px; height:480px; padding: 10px" data-options="
                iconCls: 'icon-save',
                buttons: '#Enterprisedlg-buttons'
            ">
        <form id="ff" method="post">
            <table border="0" style=" width:100%; border-collapse:separate; border-spacing:0px 6px;">
                <tr id="UserNameTD">
                    <td style=" text-align:right;">*用户名称:</td>
                    <td></td>
                    <td style=" text-align:left;"><input id="UserNametxt" name="UserNametxt" class="f1 easyui-textbox" style="width:95%;" /></td>

                    <td style=" text-align:right;"></td>
                    <td style=" text-align:left;"></td>
                </tr>
                <tr>
                    <td style=" text-align:right;">*企业名称:</td>
                    <td></td>
                    <td style=" text-align:left;"><input id="EnterpriseName" name="EnterpriseName" class="f1 easyui-textbox" style="width:95%;" /></td>

                    <td style=" text-align:right;">*信用代码:</td>
                    <td style=" text-align:left;"><input id="Code" name="Code" class="f1 easyui-textbox" style="width:95%;" /></td>
                </tr>
                <tr>
                    <td style=" text-align:right;">*营业执照:</td>
                    <td></td>
                    <td style=" text-align:left;"><input id="BusinessLicenseFile" name="BusinessLicenseFile" data-options="buttonText:'选择',prompt:'请选择文件...'" class="f1 easyui-filebox" style="width:95%;" /></td>
                    <td style=" text-align:right;">登记注册类型:</td>
                    <td style=" text-align:left;"><select id="RegistTypeCmb" class=" easyui-combobox" name="RegistTypeCmb" label="" style="width:95%"></select></td>
                </tr>
                <tr>

                    <td style=" text-align:right;">*行业分类:</td>
                    <td></td>
                    <td style=" text-align:left;"><select id="ProfessionCmb" class="easyui-combobox" name="ProfessionCmb" label="" style="width:95%"></select></td>
                    <td style=" text-align:right;">*企业类型:</td>
                    <td style=" text-align:left;"><select id="EnterpriseTypeCmb" class="easyui-combobox" name="EnterpriseTypeCmb" label="" style="width:95%"></select></td>
                </tr>

                <tr>
                    <td style=" text-align:right;">*注册地:</td>
                    <td></td>
                    <td style=" text-align:left;"><select id="RegistRegionCmb" class="easyui-combobox" name="RegistRegionCmb" label="" style="width:95%"></select></td>
                    <td style=" text-align:right;">*环评结果:</td>
                    <td style=" text-align:left;"><select id="HuanpingCmb" class="easyui-combobox" name="HuanpingCmb" label="" style="width:95%"></select></td>
                </tr>
                <tr></tr>
                <tr>
                    <td style=" text-align:right;">注册资金额度:</td>
                    <td></td>
                    <td style=" text-align:left;"><select id="RegFinanceCmb" class="easyui-combobox" name="RegFinanceCmb" label="" style="width:95%"></select></td>
                    <td style=" text-align:right;">币种:</td>
                    <td style=" text-align:left;"><select id="RegFinanceMtCmb" class="easyui-combobox" name="RegFinanceMtCmb" label="" style="width:95%"></select></td>
                </tr>

                <tr>
                    <td style=" text-align:right;">企业营业范围:</td>
                    <td></td>
                    <td style=" text-align:left;"><select id="BusinessCmb" class="easyui-combobox" name="BusinessCmb" label="" style="width:95%"></select></td>
                    <td style=" text-align:right;">主要产品:</td>
                    <td style=" text-align:left;"><input id="MainProduction" name="MainProduction" class="f1 easyui-textbox" style="width:95%;" /></td>
                </tr>

                <tr>
                    <td style=" text-align:right;">*企业成立时间:</td>
                    <td></td>
                    <td style=" text-align:left;">
                        <input class="easyui-datebox" id="CreateTime" name="CreateTime" labelposition="top" style="width:95%;">
                    </td>
                    <td style=" text-align:right;">企业法人代表:</td>
                    <td style=" text-align:left;"><input id="JuridicalPerson" name="JuridicalPerson" class="f1 easyui-textbox" style="width:95%;" /></td>
                </tr>

                <tr>
                    <td style=" text-align:right;">*联系人姓名:</td>
                    <td></td>
                    <td style=" text-align:left;"><input id="ConectionPerson" name="ConectionPerson" class="f1 easyui-textbox" style="width:95%;" /></td>
                    <td style=" text-align:right;">*联系人电话:</td>
                    <td style=" text-align:left;"><input id="ConnectionTelephone" name="ConnectionTelephone" class="f1 easyui-textbox" style="width:95%;" /></td>
                </tr>
                <tr>
                    <td style=" text-align:right;">企业简介:</td>
                    <td></td>
                    <td style=" text-align:left;" colspan="3"><input id="EnterpriseDesc" name="EnterpriseDesc" class="easyui-textbox" style="width:98%;height:100px" data-options="multiline:true" /></td>
                </tr>
            </table>
        </form>
    </div>


    <div id="Enterprisedlg-buttons">
        <a href="javascript:void(0)" class="easyui-linkbutton" onclick="SaveEnterprisrInfo()">保存</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" onclick="javascript: $('#Enterprisedlg').dialog('close')">
            关闭
        </a>
    </div>
</body>
</html>
