<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>政策与公告</title>
    <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.5.1/themes/bootstrap/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.5.1/themes/icon.css" />
    <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.5.1/demo/demo.css" />
    <script type="text/javascript" src="../jquery-easyui-1.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="../jquery-easyui-1.5.1/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../jquery-easyui-1.5.1/locale/easyui-lang-zh_CN.js"></script>
    <link rel="stylesheet" href="../kindeditor-4.1.7/themes/default/default.css" />
    <link rel="stylesheet" href="../kindeditor-4.1.7/plugins/code/prettify.css" />
    <script charset="utf-8" src="../kindeditor-4.1.7/kindeditor.js"></script>
    <script charset="utf-8" src="../kindeditor-4.1.7/lang/zh_CN.js"></script>
    <script charset="utf-8" src="../kindeditor-4.1.7/plugins/code/prettify.js"></script>
    <script src="../Scripts/jquery.cookie.js"></script>
    <script type="text/javascript">
        $.parser.onComplete = function () {
            $('#loading').remove();
        }
        var editor1 = '';
        var editor2 = '';
        var UserInfo;
        var newsZcId;
        var newsGgId;
        var newstpId;
        UserInfo = JSON.parse($.cookie('UserInfo'));
        $(function () {
            $('#ZCdlg').dialog('close');
            $('#GGdlg').dialog('close');
            $('#tpdlg').dialog('close');
            loadZCDG();
            loadGGDG();
            loadImageNews_dg();
            KindEditor.ready(function (K) {
                editor1 = K.create('#contentZC', {
                    cssPath: '../kindeditor-4.1.7/plugins/code/prettify.css',
                    uploadJson: '../kindeditor-4.1.7/asp.net/upload_json.ashx',
                    fileManagerJson: '../kindeditor-4.1.7/asp.net/file_manager_json.ashx',
                    allowFileManager: true,
                    afterCreate: function () {
                        var self = this;
                        K.ctrl(document, 13, function () {
                            self.sync();
                            K('form[name=example]')[0].submit();
                        });
                        K.ctrl(self.edit.doc, 13, function () {
                            self.sync();
                            K('form[name=example]')[0].submit();
                        });
                    }
                });
            });

            KindEditor.ready(function (K) {
                editor2 = K.create('#contentGG', {
                    cssPath: '../kindeditor-4.1.7/plugins/code/prettify.css',
                    uploadJson: '../kindeditor-4.1.7/asp.net/upload_json.ashx',
                    fileManagerJson: '../kindeditor-4.1.7/asp.net/file_manager_json.ashx',
                    allowFileManager: true,
                    afterCreate: function () {
                        var self = this;
                        K.ctrl(document, 13, function () {
                            self.sync();
                            K('form[name=example]')[0].submit();
                        });
                        K.ctrl(self.edit.doc, 13, function () {
                            self.sync();
                            K('form[name=example]')[0].submit();
                        });
                    }
                });
            });

            KindEditor.ready(function (K) {
                editor3 = K.create('#contenttp', {
                    cssPath: '../kindeditor-4.1.7/plugins/code/prettify.css',
                    uploadJson: '../kindeditor-4.1.7/asp.net/upload_json.ashx',
                    fileManagerJson: '../kindeditor-4.1.7/asp.net/file_manager_json.ashx',
                    allowFileManager: true,
                    afterCreate: function () {
                        var self = this;
                        K.ctrl(document, 13, function () {
                            self.sync();
                            K('form[name=example]')[0].submit();
                        });
                        K.ctrl(self.edit.doc, 13, function () {
                            self.sync();
                            K('form[name=example]')[0].submit();
                        });
                    }
                });
            });
        });

        function loadZCDG() {
            newsZcId = '';
            $('#ZC_dg').datagrid({
                url: '../../WebServer/PublishZCGGWebService.ashx?Method=GetZCDG',
                rownumbers: true,
                singleSelect: true,
                striped: true,
                title: '政策列表',
                fitColumns: true,
                pagination: true,
                pagePosition: 'bottom',
                loadMsg: '正在加载数据...请稍后',
                pageNumber: 1,
                pageSize: 10,
                pageList: [10, 20, 30],
                columns: [[
                    { field: 'ID', title: 'ID', width: 10, hidden: true, align: 'center' },
                    { field: 'NewsTitle', title: '政策标题', width: 450, align: 'center' },
                    { field: 'Createdate', title: '创建时间', width: 250, align: 'center' },
                    { field: 'CreateUser', title: '创建人员', width: 250, align: 'center' }
                ]], toolbar: [{
                    iconCls: 'icon-add',
                    text: '发布政策',
                    handler: function () {
                        $('#ZCdlg').dialog('open');
                    }
                }, '-', {
                    iconCls: 'icon-remove',
                    text: '删除政策',
                    handler: function () {
                        DelZC();
                    }
                }],
                onClickRow: (function (index, data) {
                    newsZcId = data.ID;
                }),
                onDblClickRow: (function (index, row) {
                })
            });
        }

        function loadGGDG() {
            newsGgId = '';
            $('#GG_dg').datagrid({
                url: '../../WebServer/PublishZCGGWebService.ashx?Method=GetGGDG',
                rownumbers: true,
                singleSelect: true,
                striped: true,
                title: '公告列表',
                fitColumns: true,
                pagination: true,
                pagePosition: 'bottom',
                loadMsg: '正在加载数据...请稍后',
                pageNumber: 1,
                pageSize: 10,
                pageList: [10, 20, 30],
                columns: [[
                    { field: 'ID', title: 'ID', width: 10, hidden: true, align: 'center' },
                    { field: 'NewsTitle', title: '公告标题', width: 450, align: 'center' },
                    { field: 'Createdate', title: '创建时间', width: 250, align: 'center' },
                    { field: 'CreateUser', title: '创建人员', width: 250, align: 'center' }
                ]], toolbar: [{
                    iconCls: 'icon-add',
                    text: '发布公告',
                    handler: function () {
                        $('#GGdlg').dialog('open');
                    }
                }, '-', {
                    iconCls: 'icon-remove',
                    text: '删除公告',
                    handler: function () {
                        DelGG();
                    }
                }],
                onClickRow: (function (index, data) {
                    newsGgId = data.ID;
                }),
                onDblClickRow: (function (index, row) {
                })
            });
        }

        function loadImageNews_dg() {
            newstpId = '';
            $('#ImageNews_dg').datagrid({
                url: '../../WebServer/PublishZCGGWebService.ashx?Method=GettpDG',
                rownumbers: true,
                singleSelect: true,
                striped: true,
                title: '图片新闻列表',
                fitColumns: true,
                pagination: true,
                pagePosition: 'bottom',
                loadMsg: '正在加载数据...请稍后',
                pageNumber: 1,
                pageSize: 10,
                pageList: [10, 20, 30],
                columns: [[
                    { field: 'ID', title: 'ID', width: 10, hidden: true, align: 'center' },
                    { field: 'NewsTitle', title: '图片新闻标题', width: 450, align: 'center' },
                    { field: 'Createdate', title: '创建时间', width: 250, align: 'center' },
                    { field: 'CreateUser', title: '创建人员', width: 250, align: 'center' }
                ]], toolbar: [{
                    iconCls: 'icon-add',
                    text: '发布图片新闻',
                    handler: function () {
                        $('#CreateUser').textbox('setValue', UserInfo["name"]);
                        $('#tpdlg').dialog('open');
                    }
                }, '-', {
                    iconCls: 'icon-remove',
                    text: '删除图片新闻',
                    handler: function () {
                        Deltp();
                    }
                }],
                onClickRow: (function (index, data) {
                    newstpId = data.ID;
                }),
                onDblClickRow: (function (index, row) {
                })
            });
        }

        function savetp() {
            if ($('#NewsTitle').val() === '') {
                $.messager.alert('提示', '必须填写图片新闻标题！', 'info');
            }
            else if ($('#imagetp').textbox('getValue') == "") {
                $.messager.alert('提示', '请上传新闻图片', 'info');
            }
            else if (editor3.html() === '') {
                $.messager.alert('提示', '图片新闻内容必须填写！', 'info');
            } else {

                $('#contenttp').val(encodeURIComponent(editor3.html()));
                var formData = new FormData($("#ff")[0]);
                $.ajax({
                    url: "../../WebServer/PublishZCGGWebService.ashx?Method=Addtp",
                    type: 'POST',
                    data: formData,
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        if (data > 0) {
                            loadImageNews_dg();
                            $.messager.alert('提示', '保存成功', 'info');
                            $('#tpdlg').dialog('close');
                        } else {
                            $.messager.alert('提示', '保存失败', 'error');
                        }
                    }
                });
            }
        }

        function saveZC() {
            if ($('#titleZC').val() === '') {
                $.messager.alert('提示', '必须填写政策标题！', 'info');
            }
            else if (editor1.html() === '') {
                $.messager.alert('提示', '政策内容必须填写！', 'info');
            } else {
                $.ajax({
                    type: "POST",
                    url: "../../WebServer/PublishZCGGWebService.ashx?Method=AddZC",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({
                        "CreateUser": UserInfo["name"],
                        "NewsContent": editor1.html(),
                        "NewsTitle": $('#titleZC').val().trim()
                    }),
                    dataType: "text",
                    success: function (text) {
                        if (text > 0) {
                            $('#ZCdlg').dialog('close');
                            $.messager.alert('提示', '政策添加成功！', 'info');
                            loadZCDG();
                        }
                    },
                    error: function (message) {
                        $.messager.alert('错误提示', '政策添加出错，请重试或联系系统管理员！', 'error');
                    }
                });
            }
        }

        function saveGG() {
            if ($('#titleGG').val() === '') {
                $.messager.alert('提示', '必须填写公告标题！', 'info');
            }
            else if (editor2.html() === '') {
                $.messager.alert('提示', '公告内容必须填写！', 'info');
            } else {
                $.ajax({
                    type: "POST",
                    dataType: "text",
                    url: "../../WebServer/PublishZCGGWebService.ashx?Method=AddGG",
                    data: JSON.stringify({
                        "CreateUser": UserInfo["name"],
                        "NewsContent": editor2.html(),
                        "NewsTitle": $('#titleGG').val().trim()
                    }),
                    success: function (text) {
                        if (text > 0) {
                            $('#GGdlg').dialog('close');
                            $.messager.alert('提示', '公告添加成功！', 'info');
                            loadGGDG();
                        }
                    },
                    error: function () {
                        $.messager.alert('错误提示', '公告添加出错，请重试或联系系统管理员！', 'error');
                    }
                });
            }
        }
        function Deltp() {
            if (newstpId === '') {
                $.messager.alert('提示', '请选择需要删除的图片新闻！', 'info');
            } else {
                $.messager.confirm('确认', '您确认想要删除该篇图片新闻吗？', function (r) {
                    if (r) {
                        $.ajax({
                            type: "POST",
                            dataType: "text",
                            url: "../../WebServer/PublishZCGGWebService.ashx?Method=DelNews",
                            data: { 'newsId': newstpId },
                            success: function (text) {
                                if (text > 0) {
                                    $.messager.alert('提示', '图片新闻删除成功！', 'info');
                                    loadImageNews_dg();
                                    newsZcId = '';
                                }
                            },
                            error: function () {
                                $.messager.alert('错误提示', '图片新闻删除出错，请重试或联系系统管理员！', 'error');
                            }
                        });
                    }
                });
            }
        }

        function DelZC() {
            if (newsZcId === '') {
                $.messager.alert('提示', '请选择需要删除的政策记录！', 'info');
            } else {
                $.messager.confirm('确认', '您确认想要删除该篇政策吗？', function (r) {
                    if (r) {
                        $.ajax({
                            type: "POST",
                            dataType: "text",
                            url: "../../WebServer/PublishZCGGWebService.ashx?Method=DelNews",
                            data: { 'newsId': newsZcId },
                            success: function (text) {
                                if (text > 0) {
                                    $.messager.alert('提示', '政策删除成功！', 'info');
                                    loadZCDG();
                                    newsZcId = '';
                                }
                            },
                            error: function () {
                                $.messager.alert('错误提示', '政策删除出错，请重试或联系系统管理员！', 'error');
                            }
                        });
                    }
                });
            }
        }
        function DelGG() {
            if (newsGgId === '') {
                $.messager.alert('提示', '请选择需要删除的公告记录！', 'info');
            } else {
                $.messager.confirm('确认', '您确认想要删除该篇公告吗？', function (r) {
                    if (r) {
                        $.ajax({
                            type: "POST",
                            dataType: "text",
                            url: "../../WebServer/PublishZCGGWebService.ashx?Method=DelNews",
                            data: { 'newsId': newsGgId },
                            success: function (text) {
                                if (text > 0) {
                                    $.messager.alert('提示', '公告删除成功！', 'info');
                                    loadGGDG();
                                    newsGgId = '';
                                }
                            },
                            error: function () {
                                $.messager.alert('错误提示', '公告删除出错，请重试或联系系统管理员！', 'error');
                            }
                        });
                    }
                });
            }
        }
    </script>
</head>
<body class="easyui-layout">
    <div id="loading" style="position:absolute;z-index:1000;top:0px;left:0px;width:100%;height:100%;background:#ffffff;">
        <font color="#15428B">加载中....</font>
    </div>
    <div data-options="region:'center'" style="height: 100%; border: 0px solid red;">
        <div>
            <table id="ZC_dg" data-options="
                iconCls: 'icon-save',
                buttons: '#ZC_dg-buttons'
            "></table>
        </div>
        <div>
            <table id="GG_dg" data-options="
                iconCls: 'icon-save',
                buttons: '#GG_dg-buttons'
            "></table>
        </div>
        <div>
            <table id="ImageNews_dg" data-options="
                iconCls: 'icon-save',
                buttons: '#ImageNews_dg-buttons'
            "></table>
        </div>
        <div id="ZCdlg" class="easyui-dialog" title="政策编辑" style="text-align: center; display: none;width: 800px; height: 500px; padding: 10px"
             data-options="
                iconCls: 'icon-save',
                buttons: '#ZCdlg-buttons'
            ">
            <table border="0" style=" width:100%; border-collapse:separate; border-spacing:0px 6px;">
                <tr>
                    <td style=" text-align:right;">标题:</td>
                    <td style=" text-align:left;"><input id="titleZC" name="name" class="f1 easyui-textbox" style="width: 80%;" /></td>
                </tr>
                <tr>
                    <td style=" text-align:right;">详细内容:</td>
                    <td style=" text-align:left;"><textarea id="contentZC" name="content" style="width:100%; height:350px;"></textarea></td>
                </tr>
            </table>
        </div>
        <div id="GGdlg" class="easyui-dialog" title="公告编辑" style="text-align: center; display: none;width: 800px; height: 500px; padding: 10px"
             data-options="
                iconCls: 'icon-save',
                buttons: '#GGdlg-buttons'
            ">
            <table border="0" style=" width:100%; border-collapse:separate; border-spacing:0px 6px;">
                <tr>
                    <td style=" text-align:right;">标题:</td>
                    <td style=" text-align:left;"><input id="titleGG" name="name" class="f1 easyui-textbox" style="width:80%;" /></td>
                </tr>
                <tr>
                    <td style=" text-align:right;">详细内容:</td>
                    <td style=" text-align:left;"><textarea id="contentGG" name="content1" style="width:100%; height:350px;"></textarea></td>
                </tr>
            </table>
        </div>
        <div id="tpdlg" class="easyui-dialog" title="图片新闻编辑" style="text-align: center; display: none;width: 800px; height: 500px; padding: 10px"
             data-options="
                iconCls: 'icon-save',
                buttons: '#tpdlg-buttons'
            ">
            <form id="ff" method="post">
                <table border="0" style=" width:100%; border-collapse:separate; border-spacing:0px 6px;">
                    <tr id="UserNameTD" style="display:none;">
                        <td style=" text-align:right;">*用户名称:</td>
                        <td style=" text-align:left;"><input id="CreateUser" name="CreateUser" class="f1 easyui-textbox" style="width:95%;" /></td>
                    </tr>
                    <tr>
                        <td style=" text-align:right;">标题:</td>
                        <td style=" text-align:left;"><input id="titletp" name="titletp" class="f1 easyui-textbox" style="width:80%;" /></td>
                    </tr>
                    <tr>
                        <td style=" text-align:right;">新闻图片:</td>
                        <td style=" text-align:left;"><input id="imagetp" name="imagetp" data-options="buttonText:'选择',prompt:'请选择JPEG格式图像文件...',accept:'image/jpeg'" class="f1 easyui-filebox" style="width:80%;" /></td>
                    </tr>
                    <tr>
                        <td style=" text-align:right;">详细内容:</td>
                        <td style=" text-align:left;"><textarea id="contenttp" name="contenttp" style="width:100%; height:320px;"></textarea></td>
                    </tr>
                </table>
            </form>
        </div>
        <div id="tpdlg-buttons">
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="savetp()">保存</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="javascript: $('#tpdlg').dialog('close');">
                关闭
            </a>
        </div>
        <div id="ZCdlg-buttons">
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="saveZC()">保存</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="javascript: $('#ZCdlg').dialog('close');">
                关闭
            </a>
        </div>
        <div id="GGdlg-buttons">
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="saveGG()">保存</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="javascript: $('#GGdlg').dialog('close');">
                关闭
            </a>
        </div>
    </div>
</body>
</html>
